# COEIROINKv2-Galgame-texts-bridge
日本のビジュアルノベルエンジンとCOEIROINKv2のAI音声生成を接続するためにPythonで書かれたブリッジプログラムです。

# COEIROINK v2 Python接続プログラム

これは、Galgameの「テキスト読み上げ機能」のために設計されたPython接続プログラムです。COEIROINK v2のAPIを呼び出し、ゲーム内のテキストをリアルタイムで高品質な音声WAVファイルに変換します。

もちろん、Galgame以外にも、コマンドラインを介してテキストを音声に変換する必要があるあらゆる場面で使用できます。

## 🎮 Galgameのテキスト読み上げ機能設定ガイド

中国語の初心者向け攻略はあるんです、翻訳ソフトを使ってお試してに
https://tieba.baidu.com/p/10167834101

外部プログラム呼び出しをサポートするGalgameで本プログラムを使用するには、以下の手順に従って設定してください：

1. Galgameの設定で、「外部アプリケーション呼び出し」オプションを見つけます。
2. 「外部アプリケーション呼び出し」フィールドに、Pythonインタープリタのフルパスを入力します。例：
    ```
    C:\Python39\python.exe
    ```
3. 「音声パラメータ」フィールドに、以下の形式のパラメータを入力します：

    ```bash
    path/to/get_audio.py -t "%t" -o "%f" --speaker-uuid "d219f5ab-a50b-4d99-a26a-xxxxxxxx" --style-id xx --speed-scale xx
    ```

    * `path/to/get_audio.py` を、ローカルの `get_audio.py` スクリプトの実際のパスに置き換えます。
    * `d219f5ab-a50b-4d99-a26a-xxxxxxxx` を、使用したい話者のUUIDに置き換えます。
    * `xx` を、対応するスタイルID、速度などのパラメータ値に置き換えます。
    * `%t` は、ゲームによって自動的に読み上げるテキストに置き換えられます。
    * `%f` は、ゲームによって自動的に出力するWAVファイルのパスに置き換えられます。

## ⚠️ 重要な注意事項

**プログラムが正しく動作するように、以下を必ずお読みください：**

* **言語要件：** 本プログラムはCOEIROINK v2を使用して音声合成を行いますが、COEIROINK v2は日本語に最適化されています。そのため、**ゲームの日本語版を使用する必要があります**。
* **翻訳パッチ：** **翻訳パッチはサポートされていません。** 翻訳パッチは通常、ゲーム内部のテキストエンコーディングや内容を変更するため、プログラムがテキストを正しく認識してAPIに渡すことができなくなります。
* **Steamバイリンガル版：** Steamでバイリンガル切り替えをサポートするGalgameをプレイする場合、**ゲームの主言語を日本語に設定する必要があります**。そうしないと、テキスト読み上げ機能が正しく動作しません。

## 📦 準備

1. **Pythonのインストール：** システムにPython 3.6以上がインストールされていることを確認してください。
2. **必要なライブラリのインストール：**
    ```bash
    pip install requests
    ```
3. **COEIROINK v2の実行：** このスクリプトを使用する前に、COEIROINK v2アプリケーションがバックグラウンドで実行されていることを確認してください（デフォルトで `http://127.0.0.1:50032` をリッスン）。

## 📖 詳細な使い方とパラメータの説明

### 基本的な使い方

```bash
python get_audio.py -t "こんにちは" -o "hello.wav"
```

### すべてのパラメータの詳細

以下の表は、利用可能なすべてのコマンドラインパラメータ、そのデフォルト値、および詳細な説明を示しています。

| パラメータ | 短縮形 | 型 | デフォルト値 | 説明 |
|---|---|---|---|---|
| `--text` | `-t` | str | (必須) | 合成するテキスト |
| `--output` | `-o` | str | (必須) | 出力WAVファイルのパス |
| `--speaker-uuid` | | str | `3c37646f-3881-5374-2a83-149267990abc` | 話者のUUID。デフォルトはつくよみちゃん |
| `--style-id` | | int | `0` | 話者のスタイルID |
| `--speed-scale` | | float | `1.0` | 話速スケール。1.0より大きいと速く、1.0より小さいと遅くなります |
| `--pitch-scale` | | float | `0.0` | ピッチスケール。0.0より大きいと高く、0.0より小さいと低くなります |
| `--intonation-scale` | | float | `1.0` | イントネーションスケール。1.0より大きいと誇張され、1.0より小さいと平坦になります |
| `--volume-scale` | | float | `1.0` | 音量スケール |
| `--pre-phoneme-length` | | float | `0.1` | 音声開始前の無音時間（秒） |
| `--post-phoneme-length` | | float | `0.5` | 音声終了後の無音時間（秒） |
| `--output-sampling-rate` | | int | `24000` | 出力音声のサンプリングレート |
| `--api-url` | | str | `http://127.0.0.1:50032/` | COEIROINK v2 APIのURL |
| `--list-speakers` | | | (なし) | 利用可能な話者一覧とそのUUIDおよびスタイルIDを表示 |

### 使用例

1. **利用可能なすべての話者を表示：**
    ```bash
    python get_audio.py --list-speakers
    ```

2. **特定の話者とパラメータで音声を合成：**
    ```bash
    python get_audio.py -t "これはテストです" -o "test.wav" --speaker-uuid "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" --style-id 2 --speed-scale 1.2 --pitch-scale 0.1
    ```

## 🔍 話者UUIDとスタイルIDの取得方法

以下の方法で取得できます：

1. **このスクリプトを使用：** `python get_audio.py --list-speakers` コマンドを実行すると、利用可能なすべての話者情報が表示されます。
2. **COEIROINKインストールディレクトリを確認：** `COEIROINK_WIN_xxx\speaker_info\対応する話者フォルダ\metas.json` ファイルで、`speakerUuid` と `styles` の下にある `styleId` を見つけることができます。
3. **APIドキュメントにアクセス：** COEIROINK v2が実行中の場合、ブラウザで `http://127.0.0.1:50032/docs` にアクセスして、インタラクティブなAPIドキュメントを確認できます。

## 📝 背景と謝辞

私は[こちらの投稿](https://tieba.baidu.com/p/8436241968?pid=147727092459#147727092459)の作者です。

[こちらのブログ](https://blog.csdn.net/Sunlightqwq/article/details/141789130)に大いに触発されましたが、元のソリューションは主にVOICEVOX APIを対象としていたり、COEIROINK v2に直接接続できなかったり、設定可能なパラメータが少なかったため、AIを使用してこのバージョンを作成しました。
